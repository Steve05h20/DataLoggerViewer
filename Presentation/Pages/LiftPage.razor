@page "/Lift"


@using DataLoggerViewer.Presentation.ViewModels
@using DataLoggerViewer.Presentation.Component
@using DataLoggerViewer.Presentation.Services
@inject ILiftSummaryService LiftSummaryService
@inject IDateState DateState
@implements IDisposable

<LiftChartDetail LiftTimeSeries="@liftTimeSeries" />
<LiftEventSummaryTable Events="@events" />
<LiftEventSummaryDetailTable EventsDetail="@eventsDetail" />

@code {
    private IReadOnlyList<LiftEventSummaryViewModel> events = Array.Empty<LiftEventSummaryViewModel>();
    private IReadOnlyList<LiftTimeSeriesGroupViewModel> liftTimeSeries = Array.Empty<LiftTimeSeriesGroupViewModel>();
    private LiftEventSummaryDetailViewModel eventsDetail = default!;

    protected override async Task OnInitializedAsync()
    {
        DateState.RangeChanged += OnRangeChanged;
        events = await LiftSummaryService.GetEventsForSummaryId(1);
        liftTimeSeries = await LiftSummaryService.GetTimeSeriesForSummaryId(1);
        eventsDetail =  await LiftSummaryService.GetDetailsForEventsForSummaryId(1);
    }

    private async void OnRangeChanged()
    {
        events = await LiftSummaryService.GetEventsForSummaryId(1);
        liftTimeSeries = await LiftSummaryService.GetTimeSeriesForSummaryId(1);
        eventsDetail =  await LiftSummaryService.GetDetailsForEventsForSummaryId(1);
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        DateState.RangeChanged -= OnRangeChanged;
    }
}
